<!DOCTYPE html>
<html lang="en" data-theme="default">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTMLPlayer</title>
    <!-- <link rel="shortcut icon" type="image/x-icon" href="favicon.png"> -->
    <!-- <link rel="apple-touch-icon" href="/favicon.png"> -->
    <!-- <link rel="manifest" href="manifest.json"> -->
    <link rel="stylesheet" href="./Themes/styles.css" />
    <script src="https://unpkg.com/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
    <style>
      /* Enhanced styles for rounded rectangle components */
      .rounded-rectangle {
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .rounded-rectangle:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      }

      .playlist-card {
        cursor: pointer;
        display: flex;
        align-items: center;
        padding: 12px;
        margin: 8px 0;
      }

      .playlist-card.selected {
        background-color: #2196f3 !important;
        color: white;
      }

      .track-item {
        cursor: pointer;
        display: flex;
        align-items: center;
        padding: 8px 12px;
        margin: 4px 0;
      }

      .track-item.current {
        background-color: #4caf50 !important;
        color: white;
      }

      .track-item.selected {
        background-color: #ff9800 !important;
        color: white;
      }

      .control-button {
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 4px;
        color: white;
        font-weight: bold;
      }

      .control-button:hover {
        transform: scale(1.05);
      }

      .control-button:active {
        transform: scale(0.98);
      }

      .progress-bar {
        height: 6px;
        margin: 8px 0;
        cursor: pointer;
      }

      .volume-control {
        height: 32px;
        margin: 4px 0;
      }

      .notification-card {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        padding: 16px;
        color: white;
        font-weight: bold;
        min-width: 200px;
        text-align: center;
      }

      .modal-card {
        padding: 24px;
        color: white;
        min-width: 300px;
      }

      .visualizer-frame {
        margin: 16px 0;
        overflow: hidden;
      }

      /* Custom rounded rectangle variations */
      .card-left-rounded {
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
      }

      .card-right-rounded {
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
      }

      .card-top-rounded {
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
      }

      .card-bottom-rounded {
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
      }

      .card-fully-rounded {
        border-radius: 12px;
      }
    </style>
  </head>
  <body>
    <header>HTMLPlayer</header>
    <div id="container">
      <!-- Playlist Panel -->
      <div id="playlistPanel">
        <h2>Playlists</h2>
        <div id="playlistContainer">
          <!-- Playlist cards will be generated here using rounded rectangles -->
        </div>
        <div id="playlistControls">
          <input
            type="text"
            id="newPlaylistName"
            placeholder="New Playlist Name"
          />
          <div id="playlistButtons">
            <!-- Buttons will be created as rounded rectangles -->
          </div>
        </div>
        <input
          type="file"
          id="playlistArtInput"
          accept="image/*"
          style="display: none"
        />
        <div id="playlistBulkControls" style="display: none">
          <!-- Bulk control buttons will be created as rounded rectangles -->
        </div>
      </div>

      <!-- Main Player Area -->
      <div id="mainPlayer">
        <div id="trackControls">
          <!-- Track control buttons will be created as rounded rectangles -->
        </div>
        <div id="trackBulkControls" style="display: none">
          <!-- Track bulk control buttons will be created as rounded rectangles -->
        </div>
        <div id="trackList">
          <div id="trackContainer">
            <!-- Track items will be generated here using rounded rectangles -->
          </div>
        </div>

        <!-- Visualizer -->
        <div class="visualizer-section">
          <div id="visualizer-container-wrapper">
            <!-- Visualizer will be wrapped in a rounded rectangle -->
          </div>
        </div>

        <!-- Grouped Player Controls -->
        <div id="playerControls">
          <!-- Current Track Art -->
          <div id="currentTrackArt">
            <img
              id="currentArtImg"
              src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiMzMzMiIC8+PGxpbmUgeDE9IjAiIHkxPSIwIiB4Mj0iMTAwIiB5Mj0iMTAwIiBzdHJva2U9IiNmMWYxZjEiIHN0cm9rZS13aWR0aD0iNSIgLz48bGluZSB4MT0iMTAwIiB5MT0iMCIgeDI9IjAiIHkyPSIxMDAiIHN0cm9rZT0iI2YxZjFmMSIgc3Ryb2tlLXdpZHRoPSI1IiAvPjwvc3ZnPg=="
              alt="No Art"
            />
          </div>

          <!-- Inner Controls -->
          <div id="innerControls">
            <div id="controls">
              <button id="shuffleBtn" title="Shuffle" class="toggle-btn">
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M4,4 L10,4 L14,10 L10,16 L4,16"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                  <polyline
                    points="14,4 20,4 20,10"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                  <polyline
                    points="14,16 20,16 20,20"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                </svg>
                <svg class="indicator-dot" viewBox="0 0 8 8">
                  <circle cx="4" cy="4" r="4" fill="#2196F3" />
                </svg>
              </button>
              <button id="prevBtn" title="Previous">
                <svg class="icon" viewBox="0 0 24 24">
                  <polygon points="15,18 9,12 15,6" />
                </svg>
              </button>
              <button id="playPauseBtn" title="Play/Pause">
                <svg class="icon" id="playIcon" viewBox="0 0 24 24">
                  <polygon points="8,5 19,12 8,19" />
                </svg>
                <svg
                  class="icon"
                  id="pauseIcon"
                  viewBox="0 0 24 24"
                  style="display: none"
                >
                  <rect x="6" y="5" width="4" height="14" />
                  <rect x="14" y="5" width="4" height="14" />
                </svg>
              </button>
              <button id="nextBtn" title="Next">
                <svg class="icon" viewBox="0 0 24 24">
                  <polygon points="9,6 15,12 9,18" />
                </svg>
              </button>
              <button id="repeatBtn" title="Repeat" class="toggle-btn">
                <svg class="icon" viewBox="0 0 24 24">
                  <path
                    d="M17 1l4 4-4 4M7 23l-4-4 4-4"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                  <path
                    d="M3 11V9a4 4 0 0 1 4-4h10"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                  <path
                    d="M21 13v2a4 4 0 0 1-4 4H7"
                    fill="none"
                    stroke="#fff"
                    stroke-width="2"
                  />
                </svg>
                <svg class="indicator-dot" viewBox="0 0 8 8">
                  <circle cx="4" cy="4" r="4" fill="#2196F3" />
                </svg>
              </button>
            </div>

            <div id="progressContainer">
              <!-- Progress bar will be created as a rounded rectangle -->
            </div>

            <div id="timeDisplay">0:00 / 0:00</div>

            <div id="volumeContainer">
              <svg class="icon" viewBox="0 0 24 24">
                <polygon points="5,9 9,9 13,5 13,19 9,15 5,15" />
              </svg>
              <!-- Volume slider will be wrapped in a rounded rectangle -->
              <div id="volumeSliderContainer">
                <input
                  type="range"
                  id="volumeSlider"
                  min="0"
                  max="1"
                  step="0.01"
                  value="0.5"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Add Music Button -->
        <div id="uploadButtonContainer">
          <!-- Upload button will be created as a rounded rectangle -->
        </div>
      </div>
    </div>

    <!-- Popups for Adding and Processing -->
    <div id="addingPopup" style="display: none">
      <!-- Popup will be created as a rounded rectangle -->
    </div>
    <div id="processingPopup" style="display: none">
      <!-- Popup will be created as a rounded rectangle -->
    </div>

    <!-- Settings Modal -->
    <div
      id="settingsModal"
      class="modal hidden fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20"
      role="dialog"
      aria-modal="true"
      aria-labelledby="settingsTitle"
    >
      <div class="modal-content" id="settingsContent">
        <!-- Dynamic settings content will be injected here -->
      </div>
      <button
        id="closeSettings"
        style="
          position: absolute;
          top: 100px;
          right: 300px;
          z-index: 100;
          color: #000000;
          border: none;
          border-radius: 50%;
          width: 48px;
          height: 48px;
          font-size: 1.7rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
        "
        aria-label="Close Settings"
      >
        🅇
      </button>
    </div>

    <!-- Playlist Name Overlay -->
    <div
      id="playlistNameModal"
      class="modal hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
    >
      <div class="modal-content bg-gray-800 rounded-lg p-6 w-96">
        <h3 class="text-white text-lg font-bold mb-4">Create New Playlist</h3>

        <input
          type="text"
          id="playlistNameInput"
          placeholder="Enter playlist name..."
          class="w-full p-3 border border-gray-600 rounded bg-gray-700 text-white mb-4"
        />

        <div class="flex justify-end gap-3">
          <button
            id="cancelPlaylistNameBtn"
            class="px-4 py-2 bg-gray-600 text-white rounded"
          >
            Cancel
          </button>
          <button
            id="savePlaylistNameBtn"
            class="px-4 py-2 bg-blue-600 text-white rounded"
          >
            Create
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Button -->
    <button
      id="settingsBtn"
      style="
        position: absolute;
        bottom: 20px;
        right: 24px;
        z-index: 100;
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        font-size: 1.7rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      ⚙️
    </button>

    <!-- Visualizer Controls Modal -->
    <div
      id="visualizer-controls-modal"
      class="modal hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center"
    >
      <div
        id="visualizer-controls"
        class="relative w-full max-w-3xl mx-4 bg-gray-900 border border-gray-700 rounded-lg p-4 shadow-lg"
        style="min-width: 340px; max-height: 90vh; overflow-y: auto"
      >
        <!-- VisualizerControls will render here -->
      </div>
    </div>

    <!-- Add a button to open the modal -->
    <button
      id="openVisualizerControls"
      style="
        position: absolute;
        bottom: 90px;
        right: 24px;
        z-index: 100;
        background: #2196f3;
        color: #fff;
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        font-size: 1.7rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      🎨
    </button>

    <input
      type="file"
      id="fileInput"
      accept="audio/*"
      multiple
      style="display: none"
    />

    <!-- Hidden original upload button (gets replaced by rounded rectangle) -->
    <button id="uploadBtn" style="display: none">Add Music</button>

    <!-- Current track information display -->
    <div
      id="currentTrackInfo"
      style="padding: 10px; color: white; text-align: center"
    >
      <div id="currentTrackTitle" style="font-weight: bold; font-size: 16px">
        No track selected
      </div>
      <div
        id="currentTrackArtist"
        style="font-size: 14px; opacity: 0.8; margin-top: 4px"
      ></div>
    </div>

    <!-- Loading indicator -->
    <div
      id="loadingIndicator"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
        color: white;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 8px;
      "
    >
      <div>Loading...</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script type="module" src="./main.ts"></script>
  </body>
</html>
